{"version":3,"file":"commands.min.js","sources":["../src/commands.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Commands helper for the Moodle tiny_fontcolor plugin.\n *\n * @module      tiny_fontcolor/commands\n * @copyright   2025 Veronica Bermegui\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n */\n\nimport {getButtonImage} from 'editor_tiny/utils';\nimport {get_string as getString} from 'core/str';\nimport {\n    component,\n    fontColorButtonName,\n    fontColorMenuItemName,\n    icon,\n} from './common';\n\n// Variables de estado del plugin\nlet colorPickerContainer = null;\nlet isPickerVisible = false;\nlet clickHandler = null;\nlet originalHide = null;\n\n/**\n * Muestra el selector de color\n */\nconst showColorPicker = (editor, buttonTitle) => {\n    // Ocultar cualquier picker visible primero\n    hideColorPicker();\n\n    // Crear contenedor del color picker\n    colorPickerContainer = document.createElement('div');\n    colorPickerContainer.className = 'fontcolor-picker';\n    Object.assign(colorPickerContainer.style, {\n        position: 'absolute',\n        zIndex: '999999',\n        backgroundColor: 'white',\n        padding: '5px',\n        borderRadius: '3px',\n        boxShadow: '0 2px 8px rgba(0,0,0,0.2)',\n        border: '1px solid #ddd'\n    });\n\n    // Crear input de color\n    const colorInput = document.createElement('input');\n    colorInput.type = 'color';\n    Object.assign(colorInput.style, {\n        width: '30px',\n        height: '30px',\n        border: 'none',\n        cursor: 'pointer',\n        padding: 0\n    });\n\n    // Evento para aplicar el color\n    colorInput.addEventListener('change', () => {\n        editor.execCommand('ForeColor', false, colorInput.value);\n        hideColorPicker();\n    });\n\n    // Posicionamiento relativo al botón\n    const button = editor.editorContainer?.querySelector(`.tox-tbtn[aria-label=\"${buttonTitle}\"]`);\n    if (button) {\n        const rect = button.getBoundingClientRect();\n        Object.assign(colorPickerContainer.style, {\n            top: `${rect.bottom + window.scrollY}px`,\n            left: `${rect.left + window.scrollX}px`\n        });\n    }\n\n    // Añadir al DOM\n    colorPickerContainer.appendChild(colorInput);\n    document.body.appendChild(colorPickerContainer);\n    isPickerVisible = true;\n\n    // Cerrar al hacer clic fuera\n    setTimeout(() => {\n        clickHandler = (e) => {\n            if (!colorPickerContainer?.contains(e.target) &&\n                !button?.contains(e.target)) {\n                hideColorPicker();\n            }\n        };\n        document.addEventListener('click', clickHandler);\n\n        // Limpiar event listener al ocultar\n        originalHide = hideColorPicker;\n        hideColorPicker = () => {\n            if (clickHandler) {\n                document.removeEventListener('click', clickHandler);\n                clickHandler = null;\n            }\n            originalHide();\n            hideColorPicker = originalHide;\n        };\n    }, 0);\n};\n\n/**\n * Oculta el selector de color\n */\nlet hideColorPicker = () => {\n    if (colorPickerContainer && isPickerVisible) {\n        document.body.removeChild(colorPickerContainer);\n        colorPickerContainer = null;\n        isPickerVisible = false;\n    }\n};\n\nexport const getSetup = async () => {\n    const [buttonTitle, menuTitle, btnImage] = await Promise.all([\n        getString('button_fontcolor', component),\n        getString('menuitem_fontcolor', component),\n        getButtonImage('icon', component)\n    ]);\n\n    return (editor) => {\n        editor.ui.registry.addIcon(icon, btnImage.html);\n\n        // Botón de la barra de herramientas\n        editor.ui.registry.addButton(fontColorButtonName, {\n            icon,\n            tooltip: buttonTitle,\n            onAction: () => {\n                if (isPickerVisible) {\n                    hideColorPicker();\n                } else {\n                    showColorPicker(editor, buttonTitle);\n                }\n            }\n        });\n\n        // Ítem del menú (comportamiento original)\n        editor.ui.registry.addMenuItem(fontColorMenuItemName, {\n            icon,\n            text: menuTitle,\n            onAction: () => {\n                editor.execCommand('ForeColor', false, '#000000');\n            }\n        });\n\n        // Cerrar picker cuando el editor pierde el foco\n        editor.on('blur', hideColorPicker);\n    };\n};"],"names":["colorPickerContainer","isPickerVisible","clickHandler","originalHide","hideColorPicker","document","body","removeChild","async","buttonTitle","menuTitle","btnImage","Promise","all","component","editor","ui","registry","addIcon","icon","html","addButton","fontColorButtonName","tooltip","onAction","createElement","className","Object","assign","style","position","zIndex","backgroundColor","padding","borderRadius","boxShadow","border","colorInput","type","width","height","cursor","addEventListener","execCommand","value","button","editorContainer","_editor$editorContain","querySelector","rect","getBoundingClientRect","top","bottom","window","scrollY","left","scrollX","appendChild","setTimeout","e","_colorPickerContainer","contains","target","removeEventListener","showColorPicker","addMenuItem","fontColorMenuItemName","text","on"],"mappings":";;;;;;;;;IAkCIA,qBAAuB,KACvBC,iBAAkB,EAClBC,aAAe,KACfC,aAAe,SAgFfC,gBAAkB,KACdJ,sBAAwBC,kBACxBI,SAASC,KAAKC,YAAYP,sBAC1BA,qBAAuB,KACvBC,iBAAkB,sBAIFO,gBACbC,YAAaC,UAAWC,gBAAkBC,QAAQC,IAAI,EACzD,mBAAU,mBAAoBC,oBAC9B,mBAAU,qBAAsBA,oBAChC,yBAAe,OAAQA,4BAGnBC,SACJA,OAAOC,GAAGC,SAASC,QAAQC,aAAMR,SAASS,MAG1CL,OAAOC,GAAGC,SAASI,UAAUC,4BAAqB,CAC9CH,KAAAA,aACAI,QAASd,YACTe,SAAU,KACFvB,gBACAG,kBAnGI,EAACW,OAAQN,yCAE7BL,kBAGAJ,qBAAuBK,SAASoB,cAAc,OAC9CzB,qBAAqB0B,UAAY,mBACjCC,OAAOC,OAAO5B,qBAAqB6B,MAAO,CACtCC,SAAU,WACVC,OAAQ,SACRC,gBAAiB,QACjBC,QAAS,MACTC,aAAc,MACdC,UAAW,4BACXC,OAAQ,yBAINC,WAAahC,SAASoB,cAAc,SAC1CY,WAAWC,KAAO,QAClBX,OAAOC,OAAOS,WAAWR,MAAO,CAC5BU,MAAO,OACPC,OAAQ,OACRJ,OAAQ,OACRK,OAAQ,UACRR,QAAS,IAIbI,WAAWK,iBAAiB,UAAU,KAClC3B,OAAO4B,YAAY,aAAa,EAAON,WAAWO,OAClDxC,2BAIEyC,qCAAS9B,OAAO+B,wDAAPC,sBAAwBC,cAAe,yBAAwBvC,oBAC1EoC,OAAQ,OACFI,KAAOJ,OAAOK,wBACpBvB,OAAOC,OAAO5B,qBAAqB6B,MAAO,CACtCsB,IAAM,GAAEF,KAAKG,OAASC,OAAOC,YAC7BC,KAAO,GAAEN,KAAKM,KAAOF,OAAOG,cAKpCxD,qBAAqByD,YAAYpB,YACjChC,SAASC,KAAKmD,YAAYzD,sBAC1BC,iBAAkB,EAGlByD,YAAW,KACPxD,aAAgByD,4DACP3D,uDAAA4D,sBAAsBC,SAASF,EAAEG,SACjCjB,MAAAA,QAAAA,OAAQgB,SAASF,EAAEG,SACpB1D,mBAGRC,SAASqC,iBAAiB,QAASxC,cAGnCC,aAAeC,gBACfA,gBAAkB,KACVF,eACAG,SAAS0D,oBAAoB,QAAS7D,cACtCA,aAAe,MAEnBC,eACAC,gBAAkBD,gBAEvB,IAgCa6D,CAAgBjD,OAAQN,gBAMpCM,OAAOC,GAAGC,SAASgD,YAAYC,8BAAuB,CAClD/C,KAAAA,aACAgD,KAAMzD,UACNc,SAAU,KACNT,OAAO4B,YAAY,aAAa,EAAO,cAK/C5B,OAAOqD,GAAG,OAAQhE"}